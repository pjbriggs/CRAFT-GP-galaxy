<tool id="credible_snps" name="Generate credible SNPs" version="0.1.0">
  <description>from disease loci</description>
  <requirements>
    <requirement type="package" version="0.0.0">CRAFT-GP</requirement>
    <requirement type="package" version="3.2.1">R</requirement>
    <requirement type="package" version="0.4.3">dplyr</requirement>
    <requirement type="package" version="2.3-1">coloc</requirement>
    <requirement type="package" version="0.2.2">readr</requirement>
    <requirement type="package" version="0.4.1">tidyr</requirement>
    <requirement type="package" version="1.0.0">stringr</requirement>
    <requirement type="package" version="1.3.2">optparse</requirement>
    <requirement type="package" version="2.7.10">python</requirement>
    <requirement type="package" version="0.16">pandas</requirement>
  </requirements>
  <stdio>
    <exit_code range="1:" />
  </stdio>
  <command><![CDATA[
  mkdir -p output/credible_snps/ &&
  python \$CRAFT_GP_SCRIPTS/filter_summary_stats.py
  --regions "$input_regions"
  --stats "$input_gwas_stats"
  --out gwas_summary.subset
  && Rscript --vanilla \$CRAFT_GP_SCRIPTS/credible_snps_main.R
  -r "$input_regions"
  -a $num_affected_samples
  -u $num_unaffected_samples
  -s gwas_summary.subset
  && mv output/credible_snps/credible_snp_list_0.99.txt "$output_snp_list"
  && mv output/credible_snps/credible_snps_0.99.bed "$output_bed"
  && mv output/credible_snps/credible_snps_0.99.txt "$output_txt"
  && mv output/credible_snps/summary_table_0.99.txt "$output_summary_table"
  ]]></command>
  <inputs>
    <param type="data" name="input_regions" format="tabular"
	   label="Disease loci regions (--regions/-r))" />
    <param type="data" name="input_gwas_stats" format="tabular"
	   label="GWAS summary statistics (--stats)" />
    <param type="integer" name="num_affected_samples" value="1962"
	   label="Number of affected samples (-a)" />
    <param type="integer" name="num_unaffected_samples" value="8923"
	   label="Number of unaffected samples (-u)" />
  </inputs>
  <outputs>
    <data name="output_snp_list" format="txt" label="SNP list" />
    <data name="output_bed" format="bed" label="BED file" />
    <data name="output_txt" format="txt" label="TXT file" />
    <data name="output_summary_table" format="tabular" label="summary table" />
  </outputs>
  <tests>
    <!-- Generate test data using:

	python scripts/filter_summary_stats.py
	++regions test-data/test_region_boundaries.in
	++stats test-data/test_summary_stats.in
	++out gwas_summary.subset
	&&
	Rscript ++vanilla scripts/credible_snps_main.R
	+r test-data/test_region_boundaries.in
	+a 1962
	+u 8923
	+s gwas_summary.subset
    -->
    <test>
      <param name="input_regions" value="test_region_boundaries.in"/>
      <param name="input_gwas_stats" value="test_summary_stats.in"/>
      <output name="output_snp_list" file="credible_snps_list.out"/>
      <output name="output_bed" file="credible_snps_bed.out"/>
      <output name="output_txt" file="credible_snps_txt.out"/>
      <output name="output_summary_table" file="credible_snps_summary_table.out"/>
    </test>
  </tests>
  <help><![CDATA[
.. class:: infomark

**What it does**

Calculates the credible SNPs within each interval.
  
.. class:: infomark

**Usage**
	]]></help>
  <citations>
    <citation type="bibtex">
      @misc{githubCRAFT-GP,
      author = {Bowes, John},
      year = {2016},
      title = {CRAFT-GP},
      publisher = {GitHub},
      journal = {GitHub repository},
      url = {https://github.com/johnbowes/CRAFT-GP},
}</citation>
  </citations>
</tool>
